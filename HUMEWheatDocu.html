<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.547">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Agronomy and Crop Science Group, Kiel University">
<meta name="dcterms.date" content="2024-07-10">

<title>Simulation of Wheat Growth and Development</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="HUMEWheatDocu_files/libs/clipboard/clipboard.min.js"></script>
<script src="HUMEWheatDocu_files/libs/quarto-html/quarto.js"></script>
<script src="HUMEWheatDocu_files/libs/quarto-html/popper.min.js"></script>
<script src="HUMEWheatDocu_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="HUMEWheatDocu_files/libs/quarto-html/anchor.min.js"></script>
<link href="HUMEWheatDocu_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="HUMEWheatDocu_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="HUMEWheatDocu_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="HUMEWheatDocu_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="HUMEWheatDocu_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<meta name="mermaid-theme" content="neutral">
<script src="HUMEWheatDocu_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="HUMEWheatDocu_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="HUMEWheatDocu_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="4">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#development" id="toc-development" class="nav-link active" data-scroll-target="#development"><span class="header-section-number">1</span> Development</a>
  <ul>
  <li><a href="#calculation-of-changes-of-gs-and-bbch" id="toc-calculation-of-changes-of-gs-and-bbch" class="nav-link" data-scroll-target="#calculation-of-changes-of-gs-and-bbch"><span class="header-section-number">1.1</span> Calculation of changes of GS and BBCH</a>
  <ul class="collapse">
  <li><a href="#sowing-to-emergence-gs-8-and-9" id="toc-sowing-to-emergence-gs-8-and-9" class="nav-link" data-scroll-target="#sowing-to-emergence-gs-8-and-9"><span class="header-section-number">1.1.1</span> Sowing to emergence (GS 8 and 9)</a></li>
  <li><a href="#emergence-to-terminal-spikelet-initiation-gs-1" id="toc-emergence-to-terminal-spikelet-initiation-gs-1" class="nav-link" data-scroll-target="#emergence-to-terminal-spikelet-initiation-gs-1"><span class="header-section-number">1.1.2</span> Emergence to terminal Spikelet initiation (GS 1)</a>
  <ul class="collapse">
  <li><a href="#vernalisation" id="toc-vernalisation" class="nav-link" data-scroll-target="#vernalisation"><span class="header-section-number">1.1.2.1</span> Vernalisation</a></li>
  <li><a href="#photoperiod" id="toc-photoperiod" class="nav-link" data-scroll-target="#photoperiod"><span class="header-section-number">1.1.2.2</span> Photoperiod</a></li>
  <li><a href="#leaf-number-and-leaf-initiation" id="toc-leaf-number-and-leaf-initiation" class="nav-link" data-scroll-target="#leaf-number-and-leaf-initiation"><span class="header-section-number">1.1.2.3</span> Leaf number and leaf initiation</a></li>
  </ul></li>
  <li><a href="#terminal-spikelet-to-end-of-leaf-growth-and-beginning-of-ear-growth-gs-2" id="toc-terminal-spikelet-to-end-of-leaf-growth-and-beginning-of-ear-growth-gs-2" class="nav-link" data-scroll-target="#terminal-spikelet-to-end-of-leaf-growth-and-beginning-of-ear-growth-gs-2"><span class="header-section-number">1.1.3</span> Terminal spikelet to end of leaf growth and beginning of ear growth (GS 2)</a></li>
  <li><a href="#end-of-leaf-growth-and-beginning-of-ear-growth-to-end-of-pre-anthesis-ear-growth-gs3" id="toc-end-of-leaf-growth-and-beginning-of-ear-growth-to-end-of-pre-anthesis-ear-growth-gs3" class="nav-link" data-scroll-target="#end-of-leaf-growth-and-beginning-of-ear-growth-to-end-of-pre-anthesis-ear-growth-gs3"><span class="header-section-number">1.1.4</span> End of leaf growth and beginning of ear growth to end of pre-anthesis ear growth (GS3)</a></li>
  <li><a href="#end-of-pre-anthesis-ear-growth-to-beginning-of-grain-filling-gs4" id="toc-end-of-pre-anthesis-ear-growth-to-beginning-of-grain-filling-gs4" class="nav-link" data-scroll-target="#end-of-pre-anthesis-ear-growth-to-beginning-of-grain-filling-gs4"><span class="header-section-number">1.1.5</span> End of pre-anthesis ear growth to beginning of grain filling (GS4)</a></li>
  <li><a href="#grain-filling-gs5" id="toc-grain-filling-gs5" class="nav-link" data-scroll-target="#grain-filling-gs5"><span class="header-section-number">1.1.6</span> Grain filling (GS5)</a></li>
  <li><a href="#end-of-grain-filling-to-harvest-gs6" id="toc-end-of-grain-filling-to-harvest-gs6" class="nav-link" data-scroll-target="#end-of-grain-filling-to-harvest-gs6"><span class="header-section-number">1.1.7</span> End of grain filling to harvest (GS6)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#dry-matter-production" id="toc-dry-matter-production" class="nav-link" data-scroll-target="#dry-matter-production"><span class="header-section-number">2</span> Dry matter production</a>
  <ul>
  <li><a href="#radiation-interception" id="toc-radiation-interception" class="nav-link" data-scroll-target="#radiation-interception"><span class="header-section-number">2.1</span> Radiation interception</a></li>
  <li><a href="#limiting-factors-on-lue" id="toc-limiting-factors-on-lue" class="nav-link" data-scroll-target="#limiting-factors-on-lue"><span class="header-section-number">2.2</span> Limiting factors on LUE</a>
  <ul class="collapse">
  <li><a href="#temperature" id="toc-temperature" class="nav-link" data-scroll-target="#temperature"><span class="header-section-number">2.2.1</span> Temperature</a></li>
  <li><a href="#drought-stress" id="toc-drought-stress" class="nav-link" data-scroll-target="#drought-stress"><span class="header-section-number">2.2.2</span> Drought stress</a></li>
  <li><a href="#nitrogen-limitations" id="toc-nitrogen-limitations" class="nav-link" data-scroll-target="#nitrogen-limitations"><span class="header-section-number">2.2.3</span> Nitrogen limitations</a></li>
  <li><a href="#co2-concentration" id="toc-co2-concentration" class="nav-link" data-scroll-target="#co2-concentration"><span class="header-section-number">2.2.4</span> CO<sub>2</sub> concentration</a></li>
  </ul></li>
  <li><a href="#daily-dry-matter-accumulation" id="toc-daily-dry-matter-accumulation" class="nav-link" data-scroll-target="#daily-dry-matter-accumulation"><span class="header-section-number">2.3</span> Daily dry matter accumulation</a></li>
  </ul></li>
  <li><a href="#dry-matter-partitioning" id="toc-dry-matter-partitioning" class="nav-link" data-scroll-target="#dry-matter-partitioning"><span class="header-section-number">3</span> Dry Matter Partitioning</a>
  <ul>
  <li><a href="#initialisation" id="toc-initialisation" class="nav-link" data-scroll-target="#initialisation"><span class="header-section-number">3.1</span> Initialisation</a></li>
  <li><a href="#seedrv-change" id="toc-seedrv-change" class="nav-link" data-scroll-target="#seedrv-change"><span class="header-section-number">3.2</span> SeedRV change</a></li>
  <li><a href="#allometric-leaf-stem-partitioning" id="toc-allometric-leaf-stem-partitioning" class="nav-link" data-scroll-target="#allometric-leaf-stem-partitioning"><span class="header-section-number">3.3</span> Allometric Leaf Stem Partitioning</a>
  <ul class="collapse">
  <li><a href="#drought-effects" id="toc-drought-effects" class="nav-link" data-scroll-target="#drought-effects"><span class="header-section-number">3.3.1</span> Drought effects</a></li>
  <li><a href="#nitrogen-effects" id="toc-nitrogen-effects" class="nav-link" data-scroll-target="#nitrogen-effects"><span class="header-section-number">3.3.2</span> Nitrogen effects</a></li>
  </ul></li>
  <li><a href="#fine-root-growth" id="toc-fine-root-growth" class="nav-link" data-scroll-target="#fine-root-growth"><span class="header-section-number">3.4</span> Fine root growth</a></li>
  <li><a href="#leaf-nitrogen-concentration" id="toc-leaf-nitrogen-concentration" class="nav-link" data-scroll-target="#leaf-nitrogen-concentration"><span class="header-section-number">3.5</span> Leaf nitrogen concentration</a>
  <ul class="collapse">
  <li><a href="#calc_leaf_n_change" id="toc-calc_leaf_n_change" class="nav-link" data-scroll-target="#calc_leaf_n_change"><span class="header-section-number">3.5.1</span> Calc_Leaf_N_Change</a></li>
  <li><a href="#stem-n" id="toc-stem-n" class="nav-link" data-scroll-target="#stem-n"><span class="header-section-number">3.5.2</span> Stem N</a></li>
  </ul></li>
  <li><a href="#grain-filling" id="toc-grain-filling" class="nav-link" data-scroll-target="#grain-filling"><span class="header-section-number">3.6</span> Grain filling</a>
  <ul class="collapse">
  <li><a href="#grain-number" id="toc-grain-number" class="nav-link" data-scroll-target="#grain-number"><span class="header-section-number">3.6.1</span> Grain number</a></li>
  <li><a href="#initialisation-1" id="toc-initialisation-1" class="nav-link" data-scroll-target="#initialisation-1"><span class="header-section-number">3.6.2</span> Initialisation</a></li>
  <li><a href="#grain-filling-1" id="toc-grain-filling-1" class="nav-link" data-scroll-target="#grain-filling-1"><span class="header-section-number">3.6.3</span> Grain filling</a>
  <ul class="collapse">
  <li><a href="#potential-harvest-index" id="toc-potential-harvest-index" class="nav-link" data-scroll-target="#potential-harvest-index"><span class="header-section-number">3.6.3.1</span> Potential harvest index</a></li>
  <li><a href="#dynamics-of-grain-filling" id="toc-dynamics-of-grain-filling" class="nav-link" data-scroll-target="#dynamics-of-grain-filling"><span class="header-section-number">3.6.3.2</span> Dynamics of grain filling</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  <li><a href="#leaf-area-development" id="toc-leaf-area-development" class="nav-link" data-scroll-target="#leaf-area-development"><span class="header-section-number">4</span> Leaf Area Development</a>
  <ul>
  <li><a href="#senescence" id="toc-senescence" class="nav-link" data-scroll-target="#senescence"><span class="header-section-number">4.1</span> Senescence</a></li>
  </ul></li>
  <li><a href="#evapotranspiration" id="toc-evapotranspiration" class="nav-link" data-scroll-target="#evapotranspiration"><span class="header-section-number">5</span> Evapotranspiration</a></li>
  <li><a href="#soil-water" id="toc-soil-water" class="nav-link" data-scroll-target="#soil-water"><span class="header-section-number">6</span> Soil water</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">7</span> Implementation</a></li>
  <li><a href="#miscellaneous" id="toc-miscellaneous" class="nav-link" data-scroll-target="#miscellaneous"><span class="header-section-number">8</span> Miscellaneous</a></li>
  <li><a href="#parameters" id="toc-parameters" class="nav-link" data-scroll-target="#parameters"><span class="header-section-number">9</span> Parameters</a></li>
  <li><a href="#literature" id="toc-literature" class="nav-link" data-scroll-target="#literature"><span class="header-section-number">10</span> Literature</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Simulation of Wheat Growth and Development</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Agronomy and Crop Science Group, Kiel University </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 10, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<style type="text/css">
p {
  text-align: justify
}
</style>
</div>
<p>This document is as a short documentation of the wheat crop-soil-model (CSM) ‘HumeWheat’ used in the current work of the agronomy group of CAU Kiel. The wheat specific part was developed within several projects with main contributions by Arne Ratjen <span class="citation" data-cites="ratjen2016 ratjen2015 ratjen2016 ratjen2015b">(<a href="#ref-ratjen2016" role="doc-biblioref">Ratjen et al., 2016</a>, <a href="#ref-ratjen2016" role="doc-biblioref">2016</a>; <a href="#ref-ratjen2015" role="doc-biblioref">RATJEN and KAGE, 2015a</a>; <a href="#ref-ratjen2015b" role="doc-biblioref">Ratjen and Kage, 2015</a>)</span>, Ulf Böttcher, Adam Luig, Dorothee Neukam <span class="citation" data-cites="neukam2016">(<a href="#ref-neukam2016" role="doc-biblioref">Neukam et al., 2016</a>)</span> <span class="citation" data-cites="neukam2015">(<a href="#ref-neukam2015" role="doc-biblioref">Neukam et al., 2015</a>)</span> and others. It is in many aspects based on the CERES-Wheat model (CW) <span class="citation" data-cites="ritchie2015">(<a href="#ref-ritchie2015" role="doc-biblioref">RITCHIE, 2015</a>)</span>, but uses different approaches especially for dry matter and nitrogen partitioning, leaf area expansion and dry matter production. Also the development part is extended in comparison to the original CERES wheat approach as it predicts BBCH stages on the basis of an explicit simulation of leaf initiation and appearance. ‘HumeWheat’ is a mechanistic CSM and runs on a daily time step. The model is of a modular design principle and was developed using an object oriented class component library (Kage and Stützel 1999a) implemented in the Borland Delphi Builder® V5 development environment. The model runs on daily time steps, but internal integration of the soil water balance module is on smaller time steps, the size dependent on the maximum changes of the soil water in the layers of the 1-D soil water balance model. Required external data inputs are the mean daily temperature [°C], precipitation [mm&nbsp;d<sup>-1</sup>], global radiation [W&nbsp;m<sup>-2</sup>], wind speed [m&nbsp;s<sup>-1</sup>], relative humidity [%] and values derived from these like vapor pressure [mbar] and saturation deficit [mbar].</p>
<section id="development" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Development</h1>
<p>The phenological model module of HumeWheat is based on phenological Ceres Wheat (CW) model for winter wheat. It has been published originally in <span class="citation" data-cites="johnen2012">(<a href="#ref-johnen2012" role="doc-biblioref">Johnen et al., 2012a</a>)</span>. The phenological process in CW is divided into nine developmental or growth stages (GS) according to <span class="citation" data-cites="ritchie2015">(<a href="#ref-ritchie2015" role="doc-biblioref">RITCHIE, 2015</a>)</span> (<a href="#tbl-CWDevStages" class="quarto-xref">Table&nbsp;1</a>), the common approach in Europe, however is the BBCH stage <span class="citation" data-cites="lancashire1991a">(<a href="#ref-lancashire1991a" role="doc-biblioref">LANCASHIRE et al., 1991</a>)</span>. Zadoks stages or equivalent BBCH values, however, are not calculated in the original phenology model of CERES-Wheat up to Version 3.0.</p>
<div id="tbl-CWDevStages" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-CWDevStages-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Development stages of the CW model (GS) and corresponding BBCH stages
</figcaption>
<div aria-describedby="tbl-CWDevStages-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>GS</th>
<th>BBCH</th>
<th>Phase</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7</td>
<td>00</td>
<td>Fallow</td>
</tr>
<tr class="even">
<td>8</td>
<td>00</td>
<td>Sowing to germination</td>
</tr>
<tr class="odd">
<td>9</td>
<td>05</td>
<td>Germination to emergence</td>
</tr>
<tr class="even">
<td>1</td>
<td>10</td>
<td>Emergence to terminal Spikelet initiation</td>
</tr>
<tr class="odd">
<td>2</td>
<td>30</td>
<td>Terminal spikelet to end of leaf growth and beginning of ear growth</td>
</tr>
<tr class="even">
<td>3</td>
<td>40</td>
<td>End of leaf growth and beginning of ear growth to end of pre-anthesis ear growth</td>
</tr>
<tr class="odd">
<td>4</td>
<td>57</td>
<td>End of pre-anthesis ear growth to beginning of grain filling</td>
</tr>
<tr class="even">
<td>5</td>
<td>71</td>
<td>Grain filling</td>
</tr>
<tr class="odd">
<td>6</td>
<td>90</td>
<td>End of grain filling to harvest</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The CW model mainly describes phenological development through the change of GS over time. In CWm we added an explicit simulation of three additional state variables, the leaf number on the main stem (nLMS), the number of initiated leaves on the main stem (inLMS) and the BBCH stage. At emergence nLMS is set to one and inLMS is set to 4 <span class="citation" data-cites="brooking2002a">(<a href="#ref-brooking2002a" role="doc-biblioref">Brooking and Jamieson, 2002</a>)</span>. This is because the embryo at the time of sowing has already three leaf primordia <span class="citation" data-cites="kirby1985">(<a href="#ref-kirby1985" role="doc-biblioref">KIRBY et al., 1985</a>)</span> and that an additional primordium is assumed to be produced until emergence. The rate of change of number of initiated leaves is calculated according to <a href="#eq-dinLMS" class="quarto-xref">Eq.&nbsp;1</a> from emergence until the last leaf primordium is formed:</p>
<p><span id="eq-dinLMS"><span class="math display">
\frac{d\,in{{L}_{MS}}}{dt}=\frac{\max
(0,T-{{T}_{b}})}{Plast}
\tag{1}</span></span></p>
<p>Where Plast is the plastochron (°Cd) T is the air temperature and T<sub>b</sub> is the base temperature. The formation of leaf primordia which produce leaves is finished some time before the double ridge stage (Bonnet, 1935; Bonnet, 1936; Muschik, 1957). The time of the cessation of leaf primordia initiation, however, is not exactly coupled to a certain GS in the CW model and is also not linked to a certain BBCH stage. From available data of BBCH 37, i.e.&nbsp;the time when the last leaf appears, it was possible to estimate an approximate GS corresponding to the formation of the final leaf primordium (<span class="math inline">GS_{flp}</span>) <em>ex post</em>. The number of visible leaves on the main stem nLMS is calculated accordingly (<a href="#eq-dnLMS" class="quarto-xref">Eq.&nbsp;2</a>):</p>
<p><span id="eq-dnLMS"><span class="math display">\frac{d\,n{{L}_{MS}}}{dt}=\frac{\max (0,T-{{T}_{b}})}{Phyll} \tag{2}</span></span></p>
<p>where Phyll denotes the phyllochron (°Cd).</p>
<section id="calculation-of-changes-of-gs-and-bbch" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="calculation-of-changes-of-gs-and-bbch"><span class="header-section-number">1.1</span> Calculation of changes of GS and BBCH</h2>
<p>The main state variables of the phenological model are the GS-stage according to Ritchie and the BBCH-stage more commonly used in the description of wheat phenology. Their rate of change is calculated stage specific.</p>
<section id="sowing-to-emergence-gs-8-and-9" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="sowing-to-emergence-gs-8-and-9"><span class="header-section-number">1.1.1</span> Sowing to emergence (GS 8 and 9)</h3>
<p>We simplified the model by pooling together the GS stages eight and nine, which represent the germination and emergence processes, because no data were available to distinguish between both events. The redefined parameter P9, which now governs the rate of development during the time from sowing to emergence, was calculated from observed thermal times from sowing to emergence .</p>
<p><span id="eq-dGS_dt_GS9"><span class="math display">\frac{dGS}{dt}=\frac{\max (0,T-{{T}_{b}})}{P9} \tag{3}</span></span></p>
<p>The rate of change for BBCH is ten time higher as for GS as the event of crop emergence is equivalent to 10.</p>
<p><span id="eq-dBBCH_dt_GS9"><span class="math display">\frac{dBBCH}{dt}=10\frac{\max (0,T-{{T}_{b}})}{P9} \tag{4}</span></span></p>
</section>
<section id="emergence-to-terminal-spikelet-initiation-gs-1" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="emergence-to-terminal-spikelet-initiation-gs-1"><span class="header-section-number">1.1.2</span> Emergence to terminal Spikelet initiation (GS 1)</h3>
<p>Temperature, vernalization, photoperiod, and phyllochron interval determine the development rate during GS 1. According to CW the lowest value of two functions, depending on the vernalization stage and the actual photoperiod in interaction with the actual effective temperature limits the development rate (<a href="#eq-dGS_dt_GS1" class="quarto-xref">Eq.&nbsp;5</a>).</p>
<p><span id="eq-dGS_dt_GS1"><span class="math display">\frac{dGS}{dt}=\frac{\max (0,T-{{T}_{b}})\cdot \min (f(V),f(P))}{(400\cdot Phyll\ /\ 95)} \tag{5}</span></span></p>
<p>The functions f(V) and f(P) as well as the Phyllocron (Phyll) are genotype specific.</p>
<section id="vernalisation" class="level4" data-number="1.1.2.1">
<h4 data-number="1.1.2.1" class="anchored" data-anchor-id="vernalisation"><span class="header-section-number">1.1.2.1</span> Vernalisation</h4>
<p>The effect of vernalisation on the development rate is calculated from the accumulated sum of “vernalisation days”. The rate of change of the vernalisation days is calculated from the daily mean temperature and a vernalisation response function which is characterized by 4 cardinal temperatures (<a href="#fig-RelVernalisation" class="quarto-xref">Figure&nbsp;1</a>).</p>
<div id="fig-RelVernalisation" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-RelVernalisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RelVernalisation.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-RelVernalisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Relative vernalisation rate of winter wheat
</figcaption>
</figure>
</div>
<p>The vernalisation rate is acccumulated in the state variable VernalisationDays.</p>
<p><span id="eq-dV_dt"><span class="math display">\frac{dV}{dt}=\max (0, fV) \tag{6}</span></span></p>
<p>The value of the f(V) in <a href="#eq-dGS_dt_GS1" class="quarto-xref">Eq.&nbsp;5</a> is calculated from the actual value of accumulated number of vernalisation dates according to:</p>
<p><span id="eq-fV_k"><span class="math display">f(V) = 1-k\cdot \left(50-V \right) \tag{7}</span></span></p>
<p>The values of k thereby is genotype specific and according to Ritchie et al.&nbsp;(1998) is coded in the parameter value P1V. The value of 50 in <a href="#eq-fV_k" class="quarto-xref">Eq.&nbsp;7</a> is the maximum number of vernalisation days. The vernalisation days are reset to zero after the maximum number of vernalisation days is reached.<br>
The value k is the slope of the linear relation between the vernalisation days and the development rate. It can be calculated from the parameter P1V according to</p>
<p><span id="eq-kfromP1V"><span class="math display">k = \frac {P1V+0.55}{183} \tag{8}</span></span> For a larger number of wheat cultivars in Germany <span class="citation" data-cites="johnen2012b">(<a href="#ref-johnen2012b" role="doc-biblioref">Johnen et al., 2012b</a>)</span> found a value of P1V of 2.84. Higher values of P1V indicate a higher vernalisation requirement of the cultivar, i.e.&nbsp;a lower development rate at low vernalisation days which is typical for cultivars of continental origin. A low value of P1V indicates a low vernalisation requirement, typical for summer crops of wheat or for wheat cultivars grown in Mediterranean regions.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-VernRate" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-VernRate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="HUMEWheatDocu_files/figure-html/fig-VernRate-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-VernRate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Relative vernalisation rate of winter wheat as a function of accumulated vernalisation days
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="photoperiod" class="level4" data-number="1.1.2.2">
<h4 data-number="1.1.2.2" class="anchored" data-anchor-id="photoperiod"><span class="header-section-number">1.1.2.2</span> Photoperiod</h4>
<p>The effect of photoperiod on the development rate (f(P)) is calculated from the actual photoperiod and a photoperiod response function</p>
<p><span id="eq-fPhoto"><span class="math display">f(P)=1-C \cdot\left(20-P\right)^2 \tag{9}</span></span></p>
<p>The parameter C is coded in the parameter P1D. The value of 20 in <a href="#eq-fPhoto" class="quarto-xref">Eq.&nbsp;9</a> is the maximum photoperiod. The value of C is the slope of the quadratic relation between the photoperiod and the development rate. It can be calculated from the parameter P1D according to</p>
<p><span id="eq-CfromP1D"><span class="math display">C=P1D/500 \tag{10}</span></span></p>
<p>Typical values of P1D are in the range of 1 to 3. Higher values of P1D indicate a higher photoperiod requirement of the cultivar, i.e.&nbsp;a lower development rate at low photoperiods which is typical for cultivars of northern origin. A low value of P1D indicates a low photoperiod requirement, typical for summer crops of wheat or for wheat cultivars grown in mediterranean regions. In the study of <span class="citation" data-cites="johnen2012a">(<a href="#ref-johnen2012a" role="doc-biblioref">Johnen et al., 2012c</a>)</span> a value of P1D of 2.76 was found as a mean for a larger number of wheat cultivars in Germany.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-PhotRate" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-PhotRate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="HUMEWheatDocu_files/figure-html/fig-PhotRate-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-PhotRate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Relative development rate of winter wheat at GS1 as a function of photoperiod
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="leaf-number-and-leaf-initiation" class="level4" data-number="1.1.2.3">
<h4 data-number="1.1.2.3" class="anchored" data-anchor-id="leaf-number-and-leaf-initiation"><span class="header-section-number">1.1.2.3</span> Leaf number and leaf initiation</h4>
<p>At early development stages (BBCH&lt;30) BBCH stages are determined by the number of leaves and tillers present. Their rate of change is determined by the Phyllochron (Phyll), i.e.&nbsp;the inverse of the phyllochron is the emergence rate of leaves and tillers per effective day temperature (@eq-dBBCH_dt_GS1).</p>
<p><span id="eq-dBBCH_dt_GS1"><span class="math display">\frac{dBBCH}{dt}=\frac{\max (0,T-{{T}_{b}})}{Phyll} \tag{11}</span></span></p>
<p>At BBCH 13.5 there is a switch to BBCH 21, because simultaneously to the appearance of the fourth leaf the first tiller is emerging and mainstem leaf appearance is then associated with tiller appearance until BBCH 30.</p>
<p>The plastochron is the inverse of the rate of leaf initiation. It is assumed to be constant during the time from sowing to the end of leaf initation. It defines the rate of leaf initiation and together with the initial number of leaf primordia of the embryo at sowing the number of initiated leaves and with the GS stage when leaf initation ceases the number of leaves on the main stem.</p>
<p><span id="eq-BBCH_jumpto21"><span class="math display">If \ \ BBCH &gt;= 13.5 \ and \ BBCH&lt;20; \    BBCH = BBCH+7.5 \tag{12}</span></span></p>
</section>
</section>
<section id="terminal-spikelet-to-end-of-leaf-growth-and-beginning-of-ear-growth-gs-2" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="terminal-spikelet-to-end-of-leaf-growth-and-beginning-of-ear-growth-gs-2"><span class="header-section-number">1.1.3</span> Terminal spikelet to end of leaf growth and beginning of ear growth (GS 2)</h3>
<p>Within the model the implicit and simplifying assumption is made that GS 2 stage is more or less closely associated with BBCH 30 <span class="citation" data-cites="baker1983">(<a href="#ref-baker1983" role="doc-biblioref">Baker and Gallagher, 1983</a>)</span>, but that the initiation of the terminal leaf primordium may be reached a bit earlier at a stage we named <span class="math inline">GS_{flp}</span>.</p>
<p>The GS change rate between GS 2 and 3 is calculated as the ratio of the daily temperature minus the base temperature (T<sub>b</sub>, assumed to be 0°C) to the thermal time interval GS 2 to GS 3. This thermal time interval is calculated by the number of leaves not yet expressed at GS 2 minus two (fL), multiplied by the phyllochron plus the temperature sum between BBCH 37 and 39, i.e.&nbsp;‘PH39’:.</p>
<p><span id="eq-dGS_dt_GS2"><span class="math display">\frac{dGS}{dt}=\frac{\max (0,T-{{T}_{b}})}{fL\cdot Phyll+Ph39} \tag{13}</span></span></p>
<p>thereby the term fL denotes the leaves which have to appear after GS 2 is reached, calculated from the number of initiated leaves at GS 2 minus 2. The substraction of two leaf primordia was made in accordance to the assumption that at least the last two vegetative primordia may not produce visible leaves, they are therefore sometimes called labile primordia <span class="citation" data-cites="griffiths1985">(<a href="#ref-griffiths1985" role="doc-biblioref">GRIFFITHS et al., 1985</a>)</span>.</p>
<p>In the CWm model we therefore calculated a rate of node emission and introduced a parameter we called ‘TSumInternode’ analogous to the phyllochron. The numerical value of this parameter is the inverse of the slope of the relation of node numbers to the temperature sum from BBCH 30. The rate of change of BBCH stages is calculated until BBCH 37 (final leaf begins to emerge) from the ratio of the effective day temperature and TSumInternode (<a href="#eq-dBBCH_dt_GS1" class="quarto-xref">Eq.&nbsp;11</a>).</p>
<p>The BBCH stage 37 is reached when the number of the emerged leaves is equal to the number of leaf primordia minus two. The subtraction of two leaf primordia was made in accordance to the assumption that at least the last two vegetative primordia may not produce visible leaves, they are therefore sometimes called labile primordia <span class="citation" data-cites="griffiths1985">(<a href="#ref-griffiths1985" role="doc-biblioref">GRIFFITHS et al., 1985</a>)</span>.</p>
<p>The length of the thermal time from sowing to the initiation of the last leaf primordium together with the plastochron now determines the number of initiated leaves. This number is variable and the new algorithm of CWm therefore also predicts a variable length of GS 2 in terms of temperature sum. In CWm the rate of development between BBCH 37 and BBCH 39, however, is again described by a certain temperature sum expressed as the newly added parameter ‘PH39’ (<a href="#eq-dBBCH_dt_GS2b" class="quarto-xref">Eq.&nbsp;15</a>). It was introduced because according to our data analysis the thermal time between BBCH 37 and 39 ratings was significantly longer than one phyllochron.</p>
<p><span id="eq-dBBCH_dt_GS2a"><span class="math display">\frac{dBBCH}{dt}=\frac{\max (0,T-{{T}_{b}})}{\text{TSumInternode}} \tag{14}</span></span></p>
<p>If nL_MS &gt; inL_MS-2 and If BBCH&lt; 37 then BBCH = 37 If BBCH&gt;=37:</p>
<p><span id="eq-dBBCH_dt_GS2b"><span class="math display">
  \frac{dBBCH}{dt}= \min \left( \frac{2\max (0,T-{{T}_{b}})}{\text{Ph39}},(40-BBCH) \right)
\tag{15}</span></span></p>
</section>
<section id="end-of-leaf-growth-and-beginning-of-ear-growth-to-end-of-pre-anthesis-ear-growth-gs3" class="level3" data-number="1.1.4">
<h3 data-number="1.1.4" class="anchored" data-anchor-id="end-of-leaf-growth-and-beginning-of-ear-growth-to-end-of-pre-anthesis-ear-growth-gs3"><span class="header-section-number">1.1.4</span> End of leaf growth and beginning of ear growth to end of pre-anthesis ear growth (GS3)</h3>
<p>The period from the end of leaf growth to the beginning of ear growth is for the GS development rate defined by a length of 2 phytochrons</p>
<p><span id="eq-dGS_dt_GS3"><span class="math display">\frac{dGS}{dt}=\frac{\max (0,T-{{T}_{b}})}{2Phyll} \tag{16}</span></span></p>
<p>The rate of change of BBCH stages is during that stage simply synchronized with the GS rate according to equation <a href="#eq-dBBCH_dt_GS3" class="quarto-xref">Eq.&nbsp;17</a>.</p>
<p><span id="eq-dBBCH_dt_GS3"><span class="math display">\frac{dBBCH}{dt}=(4+1.7(GS-3))\cdot 10-BBCH \tag{17}</span></span></p>
</section>
<section id="end-of-pre-anthesis-ear-growth-to-beginning-of-grain-filling-gs4" class="level3" data-number="1.1.5">
<h3 data-number="1.1.5" class="anchored" data-anchor-id="end-of-pre-anthesis-ear-growth-to-beginning-of-grain-filling-gs4"><span class="header-section-number">1.1.5</span> End of pre-anthesis ear growth to beginning of grain filling (GS4)</h3>
<p>The period from the end of pre-anthesis ear growth to the beginning of grain filling is for the GS development rate defined by a length of 200 degree days:</p>
<p><span id="eq-dGS_dt_GS4"><span class="math display">\frac{dGS}{dt}=\frac{\max (0,T-{{T}_{b}})}{200} \tag{18}</span></span></p>
<p>The rate of change of BBCH stages is during that stage simply synchronized with the GS rate according to equation <a href="#eq-dBBCH_dt_GS4" class="quarto-xref">Eq.&nbsp;19</a>.</p>
<p><span id="eq-dBBCH_dt_GS4"><span class="math display">\frac{dBBCH}{dt}=(5.7+1.4(GS-4))\cdot 10-BBCH \tag{19}</span></span></p>
</section>
<section id="grain-filling-gs5" class="level3" data-number="1.1.6">
<h3 data-number="1.1.6" class="anchored" data-anchor-id="grain-filling-gs5"><span class="header-section-number">1.1.6</span> Grain filling (GS5)</h3>
<p>The period of grain filling is for the GS development rate defined by a genotype specific temperature sum and the effective temperature during grain filling. The latter is calculated as the mean temperature minus the base temperature. The effective temperature is divided by the temperature sum for grain filling (TSumGF) to get the rate of change of GS 5:</p>
<p><span id="eq-dGS_dt_GS5"><span class="math display">\frac{dGS}{dt}=\frac{\max (0,(T-{{T}_{b}})-1)}{TSumGF} \tag{20}</span></span></p>
<p><span id="eq-TSumGF"><span class="math display">TSumGF = \frac{(P5+21.5)}{0.05} \tag{21}</span></span></p>
<p>The rate of change of BBCH stages is during that stage simply synchronized with the GS rate according to equation <a href="#eq-dBBCH_dt_GS5" class="quarto-xref">Eq.&nbsp;22</a>.</p>
<p><span id="eq-dBBCH_dt_GS5"><span class="math display">\frac{dBBCH}{dt}=(7.1+1.9(GS-5))\cdot 10-BBCH \tag{22}</span></span></p>
</section>
<section id="end-of-grain-filling-to-harvest-gs6" class="level3" data-number="1.1.7">
<h3 data-number="1.1.7" class="anchored" data-anchor-id="end-of-grain-filling-to-harvest-gs6"><span class="header-section-number">1.1.7</span> End of grain filling to harvest (GS6)</h3>
<p>The period from the end of grain filling to harvest is for the GS development rate defined by a length of 250 degree days:</p>
<p><span id="eq-dGS_dt_GS6"><span class="math display">\frac{dGS}{dt}=\frac{\max (0,T-{{T}_{b}})}{250} \tag{23}</span></span></p>
<p>The rate of change of BBCH stages is during that stage simply synchronized with the GS rate according to equation <a href="#eq-dBBCH_dt_GS6" class="quarto-xref">Eq.&nbsp;24</a>.</p>
<p><span id="eq-dBBCH_dt_GS6"><span class="math display">\frac{dBBCH}{dt}=(9+(GS-6))\cdot 10-BBCH \tag{24}</span></span></p>
</section>
</section>
</section>
<section id="dry-matter-production" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Dry matter production</h1>
<p>The daily dry matter accumulation (<span class="math inline">\frac{d{W_{tot}}}{dt}</span>) of the canopy is calculated according to the LUE approach, using the simple <em>big-leaf</em> canopy model. Within the source code the term <em>carbo</em> is used to denote the daily growth rate. The potential daily dry matter accumulation rate is a function of intercepted PAR multiplied with the potential light use efficiency LUE<sub>pot</sub>). LUE is affected by extremes of daily mean temperature, water limitation, nitrogen concentration of the canopy and the external CO<sub>2</sub> concentration of the atmosphere as described in the following sections.</p>
<div class="cell" data-ref-label="Modelscheme" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-Modelscheme" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Modelscheme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-Modelscheme">flowchart LR
  A(LUE&lt;sub&gt;eff&lt;/sup&gt;) -.-&gt; F
  C(f&lt;sub&gt;T&lt;/sup&gt;) -.-&gt; A
  D(SWDF) -.-&gt; A
  E(Q) --&gt; F{dW/dt}
  G(I) --&gt; E
  H(f&lt;sub&gt;int&lt;/sub&gt;) -.-&gt; E
  I(LAI) -.-&gt; H
  J((LUE&lt;sub&gt;pot&lt;/sub&gt;)) -.-&gt; A
  K(f&lt;sub&gt;SLN&lt;/sub&gt;) -.-&gt; A
  L(SLN) -.-&gt; K
  M(f&lt;sub&gt;CO2&lt;/sub&gt;) -.-&gt; A
  N(CO&lt;sub&gt;2&lt;/sub&gt;) -.-&gt; M
  O(CWSI) -.-&gt; M
  

</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Modelscheme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Calculation of daily dry matter production in HUMEWheat.
</figcaption>
</figure>
</div>
</div>
</div>
<section id="radiation-interception" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="radiation-interception"><span class="header-section-number">2.1</span> Radiation interception</h2>
<p>According to the Lambert-Beer law the fraction of the intercepted PAR is a function of leaf area index (LAI) and extinction coefficient (k<sub>PAR</sub>). Canopy reflection within the PAR range is thereby lumped into the empirical k<sub>PAR</sub> value. The state variable LAI is calculated in the leaf area module. The fraction of intercepted PAR (f<sub>int</sub>) is calculated as follows:</p>
<p><span id="eq-PARincterception"><span class="math display">Q= PAR\text{(t)} \cdot \left ( 1-{e^{-{k_{PAR}} \cdot LAI\text{(t)}}} \right) \tag{25}</span></span> This is a very simplified approach, not considering fractions of direct and diffuse radiation and their complex interactions with the canopy. To account for the effect of LAI on the extinction coefficient, the extinction coefficient is calculated as a function of LAI and the maximum extinction coefficient (k<sub>PAR</sub>ini) according to the following equation:</p>
<p><span id="eq-KPAR_fLAI"><span class="math display">k_{PAR} = min \left( k_{PAR_{max}},\ max(k_{ini}+ln(LAI) \cdot k_{dec}, \ k_{PAR}) \right) \tag{26}</span></span></p>
<p>where k<sub>ini</sub> is the initial extinction coefficient and k<sub>dec</sub> is the extinction coefficient decrease per unit of LAI. The standard extinction coefficient (k<sub>PAR</sub>max) is set to 0.7 in the model.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-kPAR" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kPAR-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="HUMEWheatDocu_files/figure-html/fig-kPAR-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kPAR-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Extinction coefficient kPAR as a function of LAI
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="limiting-factors-on-lue" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="limiting-factors-on-lue"><span class="header-section-number">2.2</span> Limiting factors on LUE</h2>
<p>Suboptimal temperature and drought stress reduces dry matter production rates below the potential. The influence of suboptimal conditions is quantified by a temperature (f<sub>T</sub>) and a soil water deficit factor (SWDF).</p>
<section id="temperature" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="temperature"><span class="header-section-number">2.2.1</span> Temperature</h3>
<p>Daily mean temperature is calculated in a classical way from observed maximum and minimum temperature. if difference between min and max temperature is high, the maximum temperature is weighted stronger.</p>
<p><span id="eq-TmaxwF"><span class="math display">if \left((T_{max} - T_{min}) &gt; \Delta T_{crit}\right)  then  \\
\quad T_{mean} = T_{max} \cdot T_{max_{wF}} + T_{min} \cdot (1 - T_{max_{wF}}) \tag{27}</span></span></p>
<p>The weighting factor <span class="math inline">T_{max_{wF}}</span> is taken as 0.567. The critical temperature difference <span class="math inline">\Delta T_{crit}</span> is set to 8°C.</p>
<p>The effect of temperature on LUE is calculated using a temperature effect factor fT [0..1] from the daily mean temperature. The base for its calculation is the equation of <span class="citation" data-cites="wang2002">(<a href="#ref-wang2002" role="doc-biblioref">Wang and Engel, 2002</a>)</span> (<a href="#eq-fT_WangEngel" class="quarto-xref">Eq.&nbsp;28</a>, <a href="#fig-fT_WangEngel" class="quarto-xref">Figure&nbsp;6</a>).</p>
<p><span id="eq-fT_WangEngel"><span class="math display">fT =  \frac{ \left( 2 \cdot (T - T_{min})^{\alpha} \cdot (T_{opt} - T_{min})^{\alpha} - (T - T_{min})^{(2 \cdot \alpha)} \right)} { (T_{opt} - T_{min})^{(2 \cdot \alpha)}} \tag{28}</span></span></p>
<p>with <span id="eq-fT_WangEngel_alpha"><span class="math display">\alpha = \frac{  ln(2)}{ln((T_{max}-T_{min})/(T_{opt}-T_{min}))} \tag{29}</span></span> For <a href="#fig-fT_WangEngel" class="quarto-xref">Figure&nbsp;6</a> the parameters Tmin = 0°C, Topt = 20°C and Tmax = 35°C were used.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-fT_WangEngel" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fT_WangEngel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="HUMEWheatDocu_files/figure-html/fig-fT_WangEngel-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fT_WangEngel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Temperature limitation factor fT as a function of mean daily temperature
</figcaption>
</figure>
</div>
</div>
</div>
<p>If available an canopy surface temperature can be used to calculate the temperature effect factor. The minimum of the obtained fT value is used for the calculation of the daily dry matter accumulation rate.</p>
</section>
<section id="drought-stress" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="drought-stress"><span class="header-section-number">2.2.2</span> Drought stress</h3>
<p>For stomatal aperture, the diffusion paths and therefore the resistances/conductivities for CO<sub>2</sub> and water evaporation are not identical, because of the liquid-phase components of the CO<sub>2</sub> pathway into the mesophyll. Consequently, a non-linear relation between transpiration and LUE reduction is assumed, according to <span class="citation" data-cites="ferreyra2003">(<a href="#ref-ferreyra2003" role="doc-biblioref">Ferreyra et al., 2003</a>)</span>. The formulation based on the RT factor technically calculated in the soil water module: RT is defined as the ratio between the sum of Tact and interception evaporation (I<sub>p</sub>) divided by the sum of T<sub>pot</sub> and I<sub>p</sub>. The factor is calculated as the ratio</p>
<p><span id="eq-RelTranspiration"><span class="math display">RT= \frac{ (T_{act}+I_p)}{(T_{pot}+I_p)} \tag{30}</span></span></p>
<p>Within the source code of <em>HUMEWheat</em> the factor RT is called <em>TransIntRatio</em>. The soil water deficit factor (SWDF) is calculated from the RT as follows:</p>
<p><span id="eq-SWDF"><span class="math display">SWDF = 1-( 1-RT )^{pSWDF} \tag{31}</span></span></p>
<p>The value of pSWDF thereby defines the non-linearity of the relation between RT and SWDF. The value of pSWDF is set to 2.5 in the model. <a href="#fig-SWDF" class="quarto-xref">Figure&nbsp;7</a> shows the relation between RT and SWDF for different values of pSWDF.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-SWDF" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SWDF-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="HUMEWheatDocu_files/figure-html/fig-SWDF-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SWDF-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Relation between RT and SWDF for different values of pSWDF
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="nitrogen-limitations" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="nitrogen-limitations"><span class="header-section-number">2.2.3</span> Nitrogen limitations</h3>
<p>Consistent with <span class="citation" data-cites="sinclair1989">Sinclair and Horie (<a href="#ref-sinclair1989" role="doc-biblioref">1989</a>)</span>, <span class="citation" data-cites="meinke1997">Meinke et al. (<a href="#ref-meinke1997" role="doc-biblioref">1997</a>)</span> and <span class="citation" data-cites="meinke1998">Meinke et al. (<a href="#ref-meinke1998" role="doc-biblioref">1998a</a>)</span> HumeWheat uses an SLN threshold value SLN<sub>crit</sub> [g N<sup>.</sup>cm<sup>-2</sup>] below which a LUE reduction factor (f<sub>SLN</sub>) is applied.</p>
<p>In a first step the optimum SLN value (SLN<sub>crit</sub>) is calculated from the initial SLN value (<span class="math inline">SLN_{crit_{int}}</span>) and the green area index (GAI) according to the following equation:</p>
<p><span id="eq-SLNcrit"><span class="math display">SLN_{crit} =SLN_{crit_{int}}+SLN_{crit_{inc}} \cdot GAI; \tag{32}</span></span></p>
<p>The values of the parameters <span class="math inline">SLN_{crit_{int}}</span> and <span class="math inline">SLN_{crit_{inc}}</span> are set to 3.74 and -0.228, respectively <span class="citation" data-cites="ratjen2015a">(<a href="#ref-ratjen2015a" role="doc-biblioref">RATJEN and KAGE, 2015b</a>)</span>. The value of <span class="math inline">SLN_{crit_{int}}</span> is the initial SLN value at GAI = 0. The value of <span class="math inline">SLN_{crit_{inc}}</span> is the increase of the SLN<sub>crit</sub> value per unit of GAI.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-SLNcrit" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SLNcrit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="HUMEWheatDocu_files/figure-html/fig-SLNcrit-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SLNcrit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Critical SLN value SLNcrit as a function of GAI
</figcaption>
</figure>
</div>
</div>
</div>
<p>The <a href="#fig-SLN_GAI" class="quarto-xref">Figure&nbsp;9</a> from <span class="citation" data-cites="ratjen2015a">RATJEN and KAGE (<a href="#ref-ratjen2015a" role="doc-biblioref">2015b</a>)</span> gives the original source of this relationship derived from an analysis of experimental data using quartile regression.</p>
<div id="fig-SLN_GAI" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SLN_GAI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="SLN_GAI.gif" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SLN_GAI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Relationship between maximum overall specific leaf nitrogen (SLN: upper 10% quantile of green area index (GAI) class intervals) and GAI. Intercept: 3·74 (P &lt; 0·001); slope: –0·228 (P &lt; 0·001).
</figcaption>
</figure>
</div>
<p>Before booting SLN<sub>crit</sub> is always lower than SLN<sub>opt</sub>.</p>
<p>A nitrogen limitation factor SLNI is calculated from the ratio of the actual SLN value (SLN) and the critical SLN value (SLN<sub>crit</sub>) according to the following equation:</p>
<p><span id="eq-SLNI"><span class="math display">SLNI = min \left( 1, \frac {SLN} {SLN_{crit}} \right) \tag{33}</span></span></p>
<p>The obtained value then SLNI is used to calculate the nitrogen limitation factor Carbo<sub>red</sub> according to the following non-linear equation:</p>
<p><span id="eq-CarboRed"><span class="math display">Carbo_{red} = min\left(1, max \left(0, SLNI_a. + SLNI_b \cdot SLNI + SLNI_c \cdot SLNI^2 \right)\right) \tag{34}</span></span></p>
<p>The values of the parameters SLNI<sub>a</sub>, SLNI<sub>b</sub> and SLNI<sub>c</sub> are set to -0.197, 2.8 and -1.6, respectively <span class="citation" data-cites="ratjen2015a">(<a href="#ref-ratjen2015a" role="doc-biblioref">RATJEN and KAGE, 2015b</a>)</span>. The value of SLNI<sub>a</sub> is the intercept of the Carbo<sub>red</sub> function. The value of SLNI<sub>b</sub> is the slope of the Carbo<sub>red</sub> function. The value of SLNI<sub>c</sub> is the curvature of the Carbo<sub>red</sub> function. The Carbo<sub>red</sub> function is shown in <a href="#fig-CarboRed" class="quarto-xref">Figure&nbsp;11</a>.<br>
The name of the variable Carbo<sub>red</sub> is derived from the original CERES-Wheat source code where it is primarily used to calculate the reduction of the photosynthesis during ripening/senescence. We use it here to calculate the general reduction of the LUE due to nitrogen limitation.</p>
<div id="fig-rLUE_SLNI" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rLUE_SLNI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="rLUE_SLNI.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rLUE_SLNI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Relationship between relative light use efficiency and the index SLNI from <span class="citation" data-cites="ratjen2015a">RATJEN and KAGE (<a href="#ref-ratjen2015a" role="doc-biblioref">2015b</a>)</span>.
</figcaption>
</figure>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-CarboRed" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-CarboRed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="HUMEWheatDocu_files/figure-html/fig-CarboRed-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-CarboRed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Carbohydrate reduction factor CarboRed as a function of SLNI
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="co2-concentration" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="co2-concentration"><span class="header-section-number">2.2.4</span> CO<sub>2</sub> concentration</h3>
<p>The effect of a varying CO<sub>2</sub> concentration on LUE is optionally calculated using a CO<sub>2</sub> effect factor f<sub>CO</sub>2~ [0..1]. Thereby an interaction with the crop water stress status is assumed. The CO<sub>2</sub> effect factor is calculated as follows:</p>
<p><span id="eq-fCO2"><span class="math display">f_{CO2} = max\left( f_{CO_2min}, \ f_{CO_2min} \cdot  \left(\left[CO_2\right]-\tau \right)^{fCO_2}  \right) \tag{35}</span></span></p>
<p>with</p>
<p><span id="eq-fCO2min"><span class="math display"> f_{CO_2min} = (f_{CO_2}scale+CWSI \cdot f_{CWSI}) \tag{36}</span></span></p>
<p>The crop water stress index is calculated from 1-TransIntRatio (0 = no drought stress, 1 = maximum drought stress). The interaction of CWSI and CO<sub>2</sub> concentration is described by the parameter f<sub>CWSI</sub>. The parameter f<sub>CO</sub>2~scale is the CO<sub>2</sub> effect factor at the CO<sub>2</sub> concentration of the compensation point (<span class="math inline">\tau</span>). The parameter f<sub>CO</sub>2~ is the slope of the CO<sub>2</sub> effect factor curve. The parameter <span class="math inline">\tau</span> is the CO<sub>2</sub> concentration at which the CO<sub>2</sub> effect factor is equal to f<sub>CO</sub>2~scale. The CO<sub>2</sub> effect factor is limited to a value between 0 and 1. It follows from <a href="#fig-fCO2eff" class="quarto-xref">Figure&nbsp;12</a> that the CO<sub>2</sub> effect factor increases with increasing CO<sub>2</sub> concentration and increasing CWSI, which means that the effect of CO<sub>2</sub> on LUE is stronger under drought stress conditions.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-fCO2eff" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fCO2eff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="HUMEWheatDocu_files/figure-html/fig-fCO2eff-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fCO2eff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: CO2 effect factor fCO2 as a function of CO2 concentration and SWDF
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="daily-dry-matter-accumulation" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="daily-dry-matter-accumulation"><span class="header-section-number">2.3</span> Daily dry matter accumulation</h2>
<p>The daily dry matter accumulation rate of the canopy is calculated as follows:</p>
<p><span id="eq-PCARB"><span class="math display">PCARB = LUE_{pot} \cdot PAR \cdot f_{int} \cdot min(f_T,Tempf_{surface})  \cdot f_{CO2} \cdot min(SWDF, Carbo_{red}) \tag{37}</span></span></p>
<p>where <span class="math inline">LUE</span> is the light use efficiency, <span class="math inline">PAR</span> is the photosynthetically active radiation, <span class="math inline">f_{int}</span> is the fraction of intercepted PAR, <span class="math inline">f_T</span> is the temperature effect factor, <span class="math inline">Tempf_{surface}</span> is the temperature effect factor calculated from the canopy surface temperature, <span class="math inline">f_{CO2}</span> is the CO<sub>2</sub> effect factor, <span class="math inline">SWDF</span> is the soil water deficit factor and <span class="math inline">Carbo_{red}</span> is the nitrogen limitation factor.</p>
<p>The daily dry matter per plant is calculated as follows:</p>
<p><span id="eq-CARBO"><span class="math display"> CARBO = PCARB / Plants \tag{38}</span></span></p>
<p>From the daily dry matter accumulation rate and the amount of intercepted radiation and the <em>effective</em> radiation use efficiency the daily dry matter accumulation rate of the canopy is calculated.</p>
<p><span id="eq-LUEeff"><span class="math display">LUE_{eff} =   \frac {PCARB}{IPAR} \tag{39}</span></span></p>
<p>where <span class="math inline">IPAR</span> is the intercepted PAR. The effective radiation use efficiency thereby sums up the different limitations of the LUE into a single value.</p>
</section>
</section>
<section id="dry-matter-partitioning" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Dry Matter Partitioning</h1>
<p>The daily dry matter accumulation rate of the canopy is partitioned into the different plant organs. The partitioning of the daily dry matter accumulation rate into the different plant organs is in contrast to many other crop growth models based on the concept of allometric relationships between the organs of the crop. The other governing principle is the concept N dilution, i.e.&nbsp;decreasing N concentrations of the organs.</p>
<p>Effects of nitrogen shortage and drought stress on the partitioning of dry matter are considered in the model, but can be switched off by setting the respectives model options.</p>
<section id="initialisation" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="initialisation"><span class="header-section-number">3.1</span> Initialisation</h2>
<p>The initial leaf weight per plant after emergence is calculated from the initial leaf area and the specific leaf area (SLA) according to the following equation:</p>
<p><span id="eq-LFWTplini"><span class="math display">LFWT_{pl} = LA_{ini} / SLA_{pot} \tag{40}</span></span></p>
<p>The stem weight per plant then is calculated from an allometric relationship between leaf and stem weight according to the following equation:</p>
<p><span id="eq-STMWTplini"><span class="math display">STMWT_{pl} = exp(g * ln(LFWT_{pl} * plants) + h) / plants \tag{41}</span></span></p>
<p>where <span class="math inline">g</span> and <span class="math inline">h</span> are parameters of the allometric relationship. The default values of <em>g</em> and <em>h</em> are set to 1.46 and -2.13 in the model.</p>
<p>The seed reserves from the parameter SEEDRV<sub>ini</sub>:</p>
<p><span id="eq-SEEDRVini"><span class="math display">SEEDRV = SEEDRV_{ini} \tag{42}</span></span></p>
<p>The nitrogen amount in the leaf fraction is calculated from the leaf nitrogen concentration under optimum N supply and the initial leaf weight per plant according to the following equation:</p>
<p><span id="eq-NLeafplini"><span class="math display">NLeaf_{pl} = LFWT_{pl} * Nc_{opt_{Leaf}} / 100 \tag{43}</span></span></p>
<p>Accordingly, the nitrogen amount in the stem fraction is calculated from the stem nitrogen concentration under optimum N supply and the initial stem weight per plant according to the following equation:</p>
<p><span id="eq-NStemplini"><span class="math display">NStem_{pl} = STMWT_{pl} * NoptStem / 100 \tag{44}</span></span></p>
<p>The initial amount of N in the shoot of a single wheat plant is calculated as the sum of the N in the leaf and stem fraction:</p>
<p><span id="eq-NShootplini"><span class="math display">NShoot_{pl} = NStoragepool_{pl} + NLeaf_{pl} + NStem_{pl} + NGrain_{pl} \tag{45}</span></span></p>
<p>The N amount in the root fraction is calculated from the initial shoot N amount and a fraction of the initial shoot N amount according to the following equation : <span id="eq-NRootplini"><span class="math display">NRoot_{pl} = NShoot_{pl} * fRootN_{ini} \tag{46}</span></span></p>
</section>
<section id="seedrv-change" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="seedrv-change"><span class="header-section-number">3.2</span> SeedRV change</h2>
<p>The seed reserves contribute to the daily dry matter accumulation rate of the canopy. Their rate of change is calculated as follows:</p>
<p><span id="eq-SEEDRVdt"><span class="math display">\frac{SEEDRV}{dt} = -k_{SEEDRV} * SEEDRV \tag{47}</span></span></p>
<p>where <span class="math inline">k_{SEEDRV}</span> is the rate of change of seed reserves. The value of <span class="math inline">k_{SEEDRV}</span> is set to 0.15 in the model, i.e.&nbsp;the daily change rate is 15% of the actual amount.</p>
<p>The rate of change of seed reserves is added to the assimilate flow calles ‘Assiflow’ in the model:</p>
<p>$$Assiflow = Assiflow - SEEDRV.c;</p>
</section>
<section id="allometric-leaf-stem-partitioning" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="allometric-leaf-stem-partitioning"><span class="header-section-number">3.3</span> Allometric Leaf Stem Partitioning</h2>
<section id="drought-effects" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="drought-effects"><span class="header-section-number">3.3.1</span> Drought effects</h3>
<p>The partitioning of dry matter between leaf and stem is influenced by the soil water potential. Under water stress conditions the partitioning of dry matter to the stem is increased (<a href="#fig-AlloDrought" class="quarto-xref">Figure&nbsp;13</a>).</p>
<div id="fig-AlloDrought" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-AlloDrought-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="jac12165-fig-0002-m.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-AlloDrought-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Relationship between the log-transformed leaf [ln(DML)] and stem mass [ln(DMS)] for W0 and W100 treatments (g=slope). W100 (black): r2 =0.96, n = 26; W0 (white): r2 =0.87, n = 23.
</figcaption>
</figure>
</div>
<p>Within the dry matter module the variable kf<sub>d</sub> describes the influence of <em>psi<sub>root</sub></em>, i.e.&nbsp;the absolute, non negative weighted average of the soil hydraulic potential on leaf stem partitioning.</p>
<p>The value of k_f is calculated as follows:</p>
<p><span id="eq-kf_d"><span class="math display">kf_d = max(1,\ 1 + (| psi_{root} | - psi_{crit}) \cdot psi_s) \tag{48}</span></span></p>
<p>where psi<sub>root</sub> is the soil hydraulic potential, psi<sub>crit</sub> is the critical soil water potential at which the leaf stem partitioning is 1 and psi<sub>s</sub> is the slope of the relationship between leaf stem partitioning and soil water potential. The default value of psi<sub>s</sub> is set to 0.296 in the model. The value of psi<sub>crit</sub> is set to a default of 2.24 MPa in the model. These parameters are from <span class="citation" data-cites="ratjen2016">Ratjen et al. (<a href="#ref-ratjen2016" role="doc-biblioref">2016</a>)</span>.</p>
<p>The value of psi<sub>crit</sub> is the critical soil water potential at which the leaf stem partitioning is 1. The value of psi<sub>s</sub> is the slope of the relationship between leaf stem partitioning and soil water potential. The default value of psi<sub>s</sub> is set to 0.296 in the model. The value of psi<sub>crit</sub> is set to a default of 2.24 MPa in the model.</p>
</section>
<section id="nitrogen-effects" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="nitrogen-effects"><span class="header-section-number">3.3.2</span> Nitrogen effects</h3>
<p>Under nitrogen deficiency a higher fraction of dry matter is partitioned to the stem. The partitioning of dry matter between leaf and stem is calculated from the nitrogen nutrition index (<a href="#eq-kf_n" class="quarto-xref">Eq.&nbsp;49</a>).</p>
<p><span id="eq-kf_n"><span class="math display">kf_n = max(1,\ 1 + (NNI_{crit} - NNI) \cdot NNI_{inc}) \tag{49}</span></span></p>
<p>where NNI<sub>crit</sub> is the critical nitrogen nutrition index at which the leaf stem partitioning is 1, NNI<sub>inc</sub> is the increase of the leaf stem partitioning per unit of NNI and NNI is the actual nitrogen nutrition index. The default value of NNI<sub>inc</sub> is set to 0.595 in the model. The value of NNI<sub>crit</sub> is set to a default of 1.377 in the model.</p>
<p>The stem fraction of shoot dry matter increase is calculated from an allometric relation ship:</p>
<p><span id="eq-fStem"><span class="math display">f_{stem*} = 1 - \frac{1}{ 1 + e^h \cdot LFWT^{g-1} \cdot g} \tag{50}</span></span></p>
<p>where LFWT is the leaf DM per square meter and h and g are parameters of the allometric relationship. The default values of g and h are set to 1.46 and -2.13 in the model.</p>
<p><span class="math display">f_{stem} = min(1, \ f_{Stem*} \cdot max(kf_d, \ kf_n))</span></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-fStem" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fStem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="HUMEWheatDocu_files/figure-html/fig-fStem-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fStem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Stem fraction of shoot dry matter increase as a function of leaf dry matter and NNI (left) and as a function of leaf dry matter and psi_root (right)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="fine-root-growth" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="fine-root-growth"><span class="header-section-number">3.4</span> Fine root growth</h2>
<p>The fraction of assimilates allocated to fine roots is calculated from a linear decrease of fine root mass with increasing temperature sum.</p>
<p><span id="eq-PTF"><span class="math display">f_{fineroot} = max \left( 0, \left(f_{FineRoot0} - f_{FineRootDec} \cdot Tempsum \right) \right) \tag{51}</span></span></p>
<p>where <span class="math inline">f_{FineRoot0}</span> is the initial fraction of assimilates allocated to fine roots, <span class="math inline">f_{FineRootDec}</span> is the decrease of the fraction of assimilates allocated to fine roots per unit of temperature sum and <span class="math inline">Tempsum</span> is the temperature sum since sowing. The default values of <span class="math inline">f_{FineRoot0}</span> and <span class="math inline">f_{FineRootDec}</span> are set to 0.653 and 0.000501 in the model.</p>
<p>Historically the fraction of assimilated allocated to the shoot is called PTF in Ceres Wheat.</p>
<p><span class="math display">PTF = min \left( 1, 1 - f_{fineroot} \right)</span></p>
<p>Effects of drought stress and nitrogen shortage on the partitioning of dry matter between shoot and root are considered in the model, but can be switched off by setting the respectives model options. These effects are implemented by altering the value of PTF and f<sub>fineroot</sub> is re-calculated from PTF.</p>
<p>Under drought stress the initial value of PTF is decreased by 0.1 times the difference between 1 and the ratio of actual to potential tranpiration (TransIntRatio) according to the following equation:</p>
<p><span id="eq-PTF_drought"><span class="math display">PTF = PTF - 0.1 \cdot (1 - TransIntRatio) \tag{52}</span></span></p>
<p>This is a preliminary parameterization of the effect of drought stress on the partitioning of dry matter between shoot and root. The value of 0.1 is a first guess and should be further calibrated.</p>
<p>Under nitrogen shortage the initial value of PTF is decreased by 0.1 times the difference between 1 and the nitrogen nutrition index (NNI) according to the following equation:</p>
<p><span id="eq-PTF_NNI"><span class="math display">PTF = PTF - 0.1 \cdot (1 - NNI) \tag{53}</span></span></p>
<p>This is a preliminary parameterization of the effect of nitrogen shortage on the partitioning of dry matter between shoot and root. The value of 0.1 is a first guess and should be further calibrated.</p>
<p>The fraction of assimilates allocated to fine roots is limited to a value between 0 and 1 and is used to calculate the daily change of the fine root mass per plant:</p>
<p><span id="eq-FFineroot"><span class="math display">f_{fineroot} = max(0, 1 - PTF) \tag{54}</span></span></p>
</section>
<section id="leaf-nitrogen-concentration" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="leaf-nitrogen-concentration"><span class="header-section-number">3.5</span> Leaf nitrogen concentration</h2>
<p>After the BBCH stage of the crop reaches the value <span class="math inline">EC_{crit_{NcLeaf}}</span>, which is set to 27, i.e.&nbsp;before shooting, the leaf nitrogen concentration [% N of DM] is calculated as follows:<br>
<span id="eq-NcOptLeaf"><span class="math display">Nc_{opt_{leaf}} = Nc_{leaf_{Vf1}} \cdot LFWT + Nc_{leaf_{Vf2}} \tag{55}</span></span> thereby <span class="math inline">Nc_{leaf_{Vf1}}</span> and <span class="math inline">Nc_{leaf_{Vf2}}</span> are parameters of the linear relationship between leaf nitrogen concentration and leaf dry matter. The default values of <span class="math inline">Nc_{leaf_{Vf1}}</span> and <span class="math inline">Nc_{leaf_{Vf2}}</span> are set to -0.0061 and 5.9543 in the model.</p>
<p>In a transitional phase between autumn and spring, the leaf nitrogen concentration is calculated as follows:</p>
<p><span id="eq-NcLeafWinter"><span class="math display">\begin{align*}
\frac{ Nc_{Leaf_{Winter}}}{dt} &amp; = (Nc_{leaf_{winter}} - Nc_{leaf_{min}}) \cdot rgr_{NcLeafWinter} \cdot \\
  &amp;  GlobRad \cdot \frac{ 1 - (Nc_{leaf_{winter}}- Nc_{leaf_{min}})}  {Nc_{Leaf_{Vf1}} \cdot LFWT + Nc_{Leaf_{Vf2}} - Nc_{leaf_{min}}}
\end{align*} \tag{56}</span></span></p>
<p>where <span class="math inline">Nc_{leaf_{min}}</span> is the minimum leaf nitrogen concentration, <span class="math inline">rgr_{NcLeafWinter}</span> is the relative growth rate of the leaf nitrogen concentration, and <span class="math inline">GlobRad</span> is the global radiation. The default values of <span class="math inline">Nc_{leaf_{min}}</span> and <span class="math inline">rgr_{NcLeafWinter}</span> are set to 1.5 and 0.0001 in the model. The value of <span class="math inline">Nc_{leaf_{min}}</span> is the minimum leaf nitrogen concentration. The value of <span class="math inline">rgr_{NcLeafWinter}</span> is the relative growth rate of the leaf nitrogen concentration. The value of <span class="math inline">GlobRad</span> is the global radiation. The value of <span class="math inline">Nc_{leaf_{min}}</span> is the minimum leaf nitrogen concentration. The value of <span class="math inline">rgr_{NcLeafWinter}</span> is the relative growth rate of the leaf nitrogen concentration. The value of <span class="math inline">GlobRad</span> is the global radiation.</p>
<p>if DayOfYear.v &lt; 150 then if TEMPM.v &gt; 0 then // transitional phase between autumn and spring Nc_optLeaf.v := NcLeafWinter.v;</p>
<section id="calc_leaf_n_change" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="calc_leaf_n_change"><span class="header-section-number">3.5.1</span> Calc_Leaf_N_Change</h3>
<p>Above the critical BBCH stage (<span class="math inline">EC_{crit_{NcLeaf}}</span>, set to EC 27, i.e.&nbsp;end of tillering) the optimum leaf nitrogen concentration is calculated from a linear dilution curve:</p>
<p><span class="math display">Nc_{opt_{Leaf}} = Nc_{Leaf_{Vf1}} \cdot LFWT_{m2} + Nc_{Leaf_{Vf2}}</span></p>
<p>The daily change of the leaf nitrogen amount per plant is calculated from the daily change of leaf dry matter and the leaf nitrogen concentration under optimal N supply and the difference between the actual leaf nitrogen amount and the optimal leaf nitrogen amount in the leaf fraction of a plant:</p>
<p><span id="eq-NLeafpl"><span class="math display">\frac {N_{Leaf_{pl}}}{dt} = \frac {LFWT_{pl}}{dt} \cdot Nc_{opt_{Leaf}} / 100 + Nc_{opt_{Leaf}} / 100 \cdot LFWT_{pl} - N_{Leaf_{pl}} \tag{57}</span></span></p>
</section>
<section id="stem-n" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="stem-n"><span class="header-section-number">3.5.2</span> Stem N</h3>
<p><span class="math display">NearOptNCStem = 0.98 \cdot (1 / (NcStem_a + NcStem_b \cdot STMWT_{m2}))</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>NcStem <span class="ot">&lt;-</span> <span class="cf">function</span>(STMWT, NcStem_a, NcStem_b){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  NcStem <span class="ot">&lt;-</span> <span class="fl">0.98</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> (NcStem_a <span class="sc">+</span> NcStem_b <span class="sc">*</span> STMWT))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(NcStem)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>STMWT <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">400</span>, <span class="dv">1</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>NcStem_a <span class="ot">&lt;-</span> <span class="fl">0.1475</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>NcStem_b <span class="ot">&lt;-</span> <span class="fl">0.0011</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>df_NcStem <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">STMWT =</span> STMWT)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>df_NcStem<span class="sc">$</span>NcStem <span class="ot">&lt;-</span> <span class="fu">NcStem</span>(df_NcStem<span class="sc">$</span>STMWT, NcStem_a, NcStem_b)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>df_NcStem<span class="sc">$</span>NcStemNearOpt <span class="ot">&lt;-</span> <span class="fl">0.98</span><span class="sc">*</span>df_NcStem<span class="sc">$</span>NcStem</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df_NcStem) <span class="sc">+</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> STMWT, <span class="at">y =</span> NcStem, <span class="at">color=</span>NcStem),<span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> STMWT, <span class="at">y =</span> NcStemNearOpt), <span class="at">size=</span><span class="dv">1</span>, <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Stem dry matter [g m^-2]"</span>, <span class="at">y =</span> <span class="st">"NcStem [%]"</span>) <span class="sc">+</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"yellow"</span>, <span class="at">high =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NcStem" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NcStem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="HUMEWheatDocu_files/figure-html/fig-NcStem-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NcStem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Stem nitrogen concentration as a function of stem dry matter
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="grain-filling" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="grain-filling"><span class="header-section-number">3.6</span> Grain filling</h2>
<section id="grain-number" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="grain-number"><span class="header-section-number">3.6.1</span> Grain number</h3>
<p>The model for grain number follows the assumption that the grain number per square meter (GPSM) is a function of the shoot dry matter at mid flowering i.e.&nbsp;EC65 (DM~65), the nitrogen nutrition index at EC 60 (NNI~60), and the average photothermal quotient from 45 d preceding anthesis (Q45):</p>
<p><span id="eq-GPSM"><span class="math display">GPSM= G4\cdot ln \left( DM_{65} \cdot min \left( NNI_{60}\right) \cdot Q45 \right)^{a} \tag{58}</span></span></p>
<p>where GM4 is a parameter of the regression equation. The default values of G4 and a are set to149.153 and 2.6233 in the model (see <a href="#fig-GPSM" class="quarto-xref">Figure&nbsp;16</a>). Within the source code the parameter G4 ist called GM4 and the parameter a is named GM4_a. See <span class="citation" data-cites="ratjen2012">(<a href="#ref-ratjen2012" role="doc-biblioref">Ratjen et al., 2012</a>)</span> for the derivation of this approach .</p>
<div id="fig-GPSM" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-GPSM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="GPSM_regression.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-GPSM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: Relationship between the log transformed product of different plant parameters (NNI60 = N nutrition status of wheat crops at anthesis, Q45= the photo thermal quotient 45 d preceding anthesis, DM65 = total shoot dry matter per square meter at anthesis) and grain number per square meter (GPSM) of wheat crops from field experiments with different N fertilizations from <span class="citation" data-cites="ratjen2012">(<a href="#ref-ratjen2012" role="doc-biblioref">Ratjen et al., 2012</a>)</span>.
</figcaption>
</figure>
</div>
<p>For the estimation of grains per plant in order to calculate the initial value of grain N an early estimate of GPSM is derived from the shoot dry matter at anthesis (TOPWT_m2) and the photothermal quotient 45 d preceding anthesis (Q45):</p>
<p>if (EC.v &gt;= 40) and (NNI60.v &lt;= 0) and if <span class="math inline">ln(TOPWT_{m2} \cdot Q45) &gt; 0</span> then</p>
<p><span id="eq-GPPVAR"><span class="math display">GPPVAR = \left ( GM4 \cdot \left ( ln \left ( TOPWT_{m2} \cdot Q45 \right) \right)^{GM4_2} \right) / plants \tag{59}</span></span></p>
<p>where GM4~2 is a parameter of the regression equation. The default value of GM4~2 is set to 0.0001 in the model.</p>
</section>
<section id="initialisation-1" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="initialisation-1"><span class="header-section-number">3.6.2</span> Initialisation</h3>
<p>The initial change of the grain weight is calculated using a sliding N and C accumulation of initial grain N &amp; C from EC 40 to 65 from the parameter <span class="math inline">GRNWT_{ini}</span> and the missing fraction of that weight. Initial grain weight per plant and the grain filling rate according to the following equation:</p>
<p><span id="eq-GRNWTplini"><span class="math display">\frac{GRNWT_{pl}}{dt} = GRNWT_{ini} / 1000 \cdot GPPVAR \cdot min\left( 1, \frac{(EC - 40)}{ (65 - 40)}\right) - GRNWT_{pl} \tag{60}</span></span></p>
<p>where <span class="math inline">GRNWT_{ini}</span> is the initial grain weight per plant, <span class="math inline">GPPVAR</span> is the grain filling rate, <span class="math inline">EC</span> is the EC stage. The value of <span class="math inline">GRNWT_{ini}</span> is set to 0.1 in the model. The value of <span class="math inline">GPPVAR</span> is set to 0.0001 in the model.<br>
Because the initial weight comes from the stem fraction, the rate of change of DM stem has to be adjusted:</p>
<p><span id="eq-STMWTpl_corr"><span class="math display">\frac{STMWT_{pl}}{dt} = \frac{STMWT_{pl}}{dt} - \frac{GRNWT_{pl}}{dt} \tag{61}</span></span></p>
</section>
<section id="grain-filling-1" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="grain-filling-1"><span class="header-section-number">3.6.3</span> Grain filling</h3>
<p>A common approach is to assume grain growth as a function of biomass accumulation after anthesis plus reserves (e.g. <span class="citation" data-cites="jamieson1998">(<a href="#ref-jamieson1998" role="doc-biblioref">Jamieson et al., 1998</a>)</span> or simply as the sum of accumulated biomass after a defined growth stage (e.g.&nbsp;Ritchie 1985). An alternative approach is to simulate potential grain yield as a linear increase in harvest index (HI) with accumulated thermal time from the beginning of grain-filling to maturity (e.g. <span class="citation" data-cites="sinclair1992 chapman1993 hammer1995 goyne1996 meinke1998a">(<a href="#ref-chapman1993" role="doc-biblioref">Chapman et al., 1993</a>; <a href="#ref-goyne1996" role="doc-biblioref">Goyne et al., 1996</a>; <a href="#ref-hammer1995" role="doc-biblioref">Hammer et al., 1995</a>; <a href="#ref-meinke1998a" role="doc-biblioref">Meinke et al., 1998b</a>; <a href="#ref-sinclair1992" role="doc-biblioref">Sinclair and Amir, 1992</a>)</span> assuming a constant or cultivar specific potential HI. Thereby, the harvest index is the ratio of grain to shoot dry mass at harvest. Simplified (according to the ‘SWMIN’ concept of Ceres-Wheat) the straw fraction of the shoot at harvest can be seen as proportional to the shoot mass at begin of spike growth (W~0), where grain mass is proportional to the shoot accumulation after ear emergence ($W$):</p>
<p><span class="math display">
HI=\frac{{{W}_{grain}}}{{{W}_{straw}}+{{W}_{grain}}}\sim\frac{\Delta W}{{{W}_{0}}+\Delta W}
</span> {eq-HI1}</p>
<p>The shoot mass accumulation is the product of the average amount of intercepted light (avL) times the average light use efficiency (avLUE) over the period of spike growth(<span class="math inline">\Delta t</span>)</p>
<p><span class="math display">\Delta W=\Delta t\times avL\times avLUE</span> {eq-DeltaW}</p>
<p>whereby <span class="math inline">\Delta t</span> is the duration of the spike growth phase in thermal time (dtt) divided by the average temperature during this period (avT):</p>
<p><span class="math display">\Delta t=\frac{dtt}{avT}</span> {eq-DeltaT}</p>
<p>Insertion of <strong>?@eq-HI1</strong> into <strong>?@eq-DeltaT</strong> yields:</p>
<p><span class="math display">\Delta W=\frac{dtt\cdot avL\cdot avLUE}{avT}=avQ\cdot avLUE\cdot dtt</span> {eq-DeltaW2}</p>
<p>whereby avQ is photo-thermal-quotient [MJ.°C-1], defined as the ratio of mean global radiation and mean temperature over the period of <span class="math inline">\Delta t</span>.</p>
<section id="potential-harvest-index" class="level4" data-number="3.6.3.1">
<h4 data-number="3.6.3.1" class="anchored" data-anchor-id="potential-harvest-index"><span class="header-section-number">3.6.3.1</span> Potential harvest index</h4>
<p>Assuming dtt and avLUE as constant, variation in HI is a function of W0 and avQ only. In unstressed crops the variation in W0 is small compared to the variation of <span class="math inline">\Delta W</span>, which is more influenced by water limitation. Thus, the potential HI (HI<sub>pot</sub>) is dominated by avQ. Following this reasoning, the potential HI in HumeWheat is calculated as a function of photo-thermal-quotient avQHI [MJ.°C-1] defined as the running ratio of mean global radiation and mean temperature over the period between booting and mid of milk ripe stage (BBCH 50-75):</p>
<p><span class="math display">HI_{pot}(t)=H{{I}_{\operatorname{int}}}+H{{I}_{inc}}\times av{{Q}_{HI}}(t)</span> {eq-HIpot}</p>
<p>where <span class="math inline">HI_{int}</span> and <span class="math inline">HI_{inc}</span> are parameters of the regression equation. The default values of <span class="math inline">HI_{int}</span> and <span class="math inline">HI_{inc}</span> are set to 0.196 and 0.2786 in the model.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HI_regression.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
<figcaption>Potential harvest index as a function of the quotient of cumulative radiation to temperature sum during grain filling where <span class="math inline">QHI_{INC}</span> and <span class="math inline">QHI_{INT}</span> are parameters of the regression equation. The default values of <span class="math inline">QHI_{INC}</span> and <span class="math inline">QHI_{INT}</span> are set to 0.196 and 0.2786 in the model.</figcaption>
</figure>
</div>
<p>The value of QHI is continuously calculated/updated from BBCH 60 to BBCH 75 as the ratio of sum of accumulated radiation to the sum of accumulated temperature since &gt;= BBCH 60.</p>
</section>
<section id="dynamics-of-grain-filling" class="level4" data-number="3.6.3.2">
<h4 data-number="3.6.3.2" class="anchored" data-anchor-id="dynamics-of-grain-filling"><span class="header-section-number">3.6.3.2</span> Dynamics of grain filling</h4>
<p>According to Ritchie and Godwin (1987), the grain mass GRNWT<sub>ini</sub> <span class="math inline">[mg\cdot grain^{-1}]</span> is initialized with 3.5 at BBCH stage 65.</p>
<section id="ec-stages-40-to-65" class="level5" data-number="3.6.3.2.1">
<h5 data-number="3.6.3.2.1" class="anchored" data-anchor-id="ec-stages-40-to-65"><span class="header-section-number">3.6.3.2.1</span> EC stages 40 to 65</h5>
<p>In order to consider pre/early flowering growth of the ear and the spike, die grain weight is linearly increased from BBCH 40 to 65 up to the value of 3.5 mg:</p>
<p><span id="eq-GRNWTpl"><span class="math display">
\frac{GRNWT_{pl}}{dt} = \frac{GRNWT_{ini}}{1000} \cdot GPPVAR \cdot min \left( 1, \frac{EC - 40} {65 - 40} \right) - GRNWT_{pl}
\tag{62}</span></span></p>
<p>Because the spike is assumed as part of the stem fraction, stem weight is reduced by the sum of the initial grain mass at beginning of grain filling.</p>
<p><span id="eq-STMWTpl"><span class="math display">\frac {dSTMWT_{pl}}{dt} = \frac {dSTMWT_{pl}}{dt} - \frac {dGRNWT_{pl}}{dt} \tag{63}</span></span></p>
</section>
<section id="ec-stages-65-to-75" class="level5" data-number="3.6.3.2.2">
<h5 data-number="3.6.3.2.2" class="anchored" data-anchor-id="ec-stages-65-to-75"><span class="header-section-number">3.6.3.2.2</span> EC stages 65 to 75</h5>
<p>The dynamisation of grain filling from the potential harvest index approach is done by inserting a relative harvest index or relativ potential harvest index (RHI) which is increasing during the grain filling according to a logistic growth function.</p>
<p>At first the parameter P5 which determines the length of the grain filling phase within the CERES model is descaled to the temperature sum for grain filling (X<sub>m</sub>) according to:</p>
<p><span id="eq-Xm"><span class="math display">X_m = \frac{(P5 + 21.5) } {0.05} \tag{64}</span></span></p>
<p>The mid of the grain filling phase is estimated from the inflection point of the logistic function of the grain filling phase using the parameter <em>dECDP</em> which is set to 250 [°Cd], but should be in an order of 0.5 times X~m.</p>
<p><span id="eq-Xmid"><span class="math display">X_{mid} = dECDP \tag{65}</span></span></p>
<p>The initial ratio of the harvest index to the potential harvest index HI/potHI (relative harvest index, RHI) is called RHI<sub>ini</sub> is calculated from the ratio of the initial grain weight (GRNWT<sub>ini</sub>) to the top weight of the plant (TOPWT<sub>pl</sub>) and the potential harvest index (HI<sub>pot</sub>) according to the following equation:</p>
<p><span id="eq-RHIINI"><span class="math display">RHI_{ini} =  \frac{ GPP \cdot GRNWT_{ini} / 1000} { TOPWT_{pl}} \cdot \frac{1}{HI_{pot}} \tag{66}</span></span></p>
<p>The intrinsic growth rate of the logistic increase of RHI during the grain filling phase r<sub>RHI</sub> is according to the following equation from the initial relative harvest index (RHI<sub>ini</sub>) and the temperature sum of mid of the grain filling phase (X<sub>mid</sub>)) approximated by the inflection point of the logistic growth equation:</p>
<p><span id="eq-rRHI"><span class="math display">r_{RHI} = ln \left( \frac{ 1 } {RHI_{ini} - 1 }\right) \cdot \frac{1}{Xmid} \tag{67}</span></span></p>
<p>The derivation of this equation is based on equation determining the time of the inflection point of a logistic growth function t_{inf} here called X<sub>mid</sub> and the assumption that the maximum value of RHI is 1:</p>
<p><span id="eq-tinf"><span class="math display">t_{inf}​= \frac{1}{r_{RHI}} \cdot ln \left( \frac{1−RHI_{ini}}{RHI_{ini}} \right) \tag{68}</span></span></p>
<p>Solving equation <a href="#eq-tinf" class="quarto-xref">Eq.&nbsp;68</a> for r_{RHI} yields equation <a href="#eq-rRHI" class="quarto-xref">Eq.&nbsp;67</a>.</p>
<p>The growth rate parameter b_RHI is calculated from the potential relative harvest index (which is 1) and the initial ratio of the harvest index to the potential harvest index according to the following equation:</p>
<p><span id="eq-bRHI"><span class="math display">b_{RHI} = \frac{1 - RHI_{ini}}{ RHI_{ini}} \tag{69}</span></span></p>
<p>The ratio of the actual harvest index to the potential harvest index (RHI) is calculated from a logistic equation with the potential harvest index K<sub>GF</sub> and the relative growth rate of the grain filling phase according to the following equation:</p>
<p><span id="eq-RHI"><span class="math display">RHI = \frac{1}{(1 + b_{RHI} * e^{(-r_{RHI} \cdot SUMDTT_{GF}))}} \tag{70}</span></span></p>
<p>See <a href="#fig-RHI" class="quarto-xref">Figure&nbsp;17</a> for the relationship between the relative potential harvest index and the cumulative temperature sum during grain filling.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(SUMDTTGF, RHI, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"SumDTTGF [°Cd]"</span>, <span class="at">ylab =</span> <span class="st">"Relative harvest index (RHI)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-RHI" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-RHI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="HUMEWheatDocu_files/figure-html/fig-RHI-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-RHI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Relative potential harvest index as a function of the cumulative temperature sum during grain filling
</figcaption>
</figure>
</div>
</div>
</div>
<p>The grain DM growth rate GROGRN is calculated from the potential, sink limited growth rate of the grains and the difference between the actual stem weight and the minimum stem weight:</p>
<p><span id="eq-GROGRNpot"><span class="math display">GROGRN_{pot} = (TOPWT_{pl} + Senwt_{pl}) \cdot  HI_{pot} * RHI - GRNWT_{pl} \tag{71}</span></span></p>
<p>The growth rate of grain per plant is calculated from the potential, sink limited growth rate of the grains and the difference between the actual stem weight and the minimum stem weight <em>SWMIN</em>:</p>
<p><span class="math display">GROGRN = max(0, min(GROGRN_{pot}, STMWT_{pl} - SWMIN))</span></p>
<p><span class="math display"> \frac{STMWT_{pl}}{dt} = \frac{STMWT_{pl}}{dt} - GROGRN</span></p>
<p>The grain weight per plant is calculated from the grain weight per plant and the growth rate of the grain weight per plant according to the following equation: <span class="math display">\frac{GRNWT_{pl}}{dt} = GROGRN</span></p>
</section>
</section>
</section>
</section>
</section>
<section id="leaf-area-development" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Leaf Area Development</h1>
<section id="senescence" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="senescence"><span class="header-section-number">4.1</span> Senescence</h2>
</section>
</section>
<section id="evapotranspiration" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Evapotranspiration</h1>
</section>
<section id="soil-water" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Soil water</h1>
</section>
<section id="implementation" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Implementation</h1>
<p>The model was implemented using an object oriented component library termed HUME <span class="citation" data-cites="kage1999">(<a href="#ref-kage1999" role="doc-biblioref">Kage and Stützel, 1999</a>)</span> on the basis of Embarcadero® Delphi® 2010 (Embarcadero Technologies, Inc., USA). The model is comprised of submodels describing plant growth and development, soil water dynamics, and evapotranspiration.</p>
</section>
<section id="miscellaneous" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Miscellaneous</h1>
<p>Temperature depended processes are calculated generally using an effective temperature <em>(T<sub>eff</sub>)</em> [°C], which is the mean daily air temperature [°C] <em>(T<sub>air</sub>)</em> minus a base temperature <em>(T<sub>base</sub> =&nbsp;2&nbsp;°C)</em> (<a href="#eq-effective-temperature" class="quarto-xref">Eq.&nbsp;72</a>).</p>
<p><span id="eq-effective-temperature"><span class="math display">T_{eff}  = \begin{cases}
T_{air} - T_{base} &amp; \text{if}~T&gt;0\\
0 &amp; \text{if}~T&lt;2
\end{cases} \tag{72}</span></span></p>
</section>
<section id="parameters" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Parameters</h1>
</section>
<section id="literature" class="level1 unnumbered" data-number="10">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">10 Literature</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-baker1983" class="csl-entry" role="listitem">
Baker, C.K., Gallagher, J.N., 1983. The development of winter wheat in the field. 1. Relation between apical development and plant morphology within and between seasons. The Journal of Agricultural Science 101, 327–335. <a href="https://doi.org/10.1017/s0021859600037631">https://doi.org/10.1017/s0021859600037631</a>
</div>
<div id="ref-brooking2002a" class="csl-entry" role="listitem">
Brooking, I.R., Jamieson, P.D., 2002. Temperature and photoperiod response of vernalization in near-isogenic lines of wheat. Field Crops Research 79, 21–38. <a href="https://doi.org/10.1016/s0378-4290(02)00106-5">https://doi.org/10.1016/s0378-4290(02)00106-5</a>
</div>
<div id="ref-chapman1993" class="csl-entry" role="listitem">
Chapman, S.C., Hammer, G.L., Meinke, H., 1993. A Sunflower Simulation Model: I. Model Development. Agronomy Journal 85, 725–735. <a href="https://doi.org/10.2134/agronj1993.00021962008500030038x">https://doi.org/10.2134/agronj1993.00021962008500030038x</a>
</div>
<div id="ref-ferreyra2003" class="csl-entry" role="listitem">
Ferreyra, R.A., Dardanelli, J.L., Pachepsky, L.B., Collino, D.J., Faustinelli, P.C., Giambastiani, G., Reddy, V.R., Jones, J.W., 2003. Nonlinear effects of water stress on peanut photosynthesis at crop and leaf scales. Ecological Modelling 168, 57–76. <a href="https://doi.org/10.1016/s0304-3800(03)00195-9">https://doi.org/10.1016/s0304-3800(03)00195-9</a>
</div>
<div id="ref-goyne1996" class="csl-entry" role="listitem">
Goyne, P., Meinke, H., Milroy, S., Hammer, G., Hare, J., 1996. Development and use of a barley crop simulation model to evaluate production management strategies in north-eastern Australia. Australian Journal of Agricultural Research 47, 997. <a href="https://doi.org/10.1071/ar9960997">https://doi.org/10.1071/ar9960997</a>
</div>
<div id="ref-griffiths1985" class="csl-entry" role="listitem">
GRIFFITHS, F.E.W., LYNDON, R.F., BENNETT, M.D., 1985. The Effects of Vernalization on the Growth of the Wheat Shoot Apex. Annals of Botany 56, 501–511. <a href="https://doi.org/10.1093/oxfordjournals.aob.a087035">https://doi.org/10.1093/oxfordjournals.aob.a087035</a>
</div>
<div id="ref-hammer1995" class="csl-entry" role="listitem">
Hammer, G.L., Sinclair, T.R., Boote, K.J., Wright, G.C., Meinke, H., Bell, M.J., 1995. A Peanut Simulation Model: I. Model Development and Testing. Agronomy Journal 87, 1085–1093. <a href="https://doi.org/10.2134/agronj1995.00021962008700060009x">https://doi.org/10.2134/agronj1995.00021962008700060009x</a>
</div>
<div id="ref-jamieson1998" class="csl-entry" role="listitem">
Jamieson, P.D., Porter, J.R., Goudriaan, J., Ritchie, J.T., Keulen, H. van, Stol, W., 1998. A comparison of the models AFRCWHEAT2, CERES-Wheat, Sirius, SUCROS2 and SWHEAT with measurements from wheat grown under drought. Field Crops Research 55, 23–44. <a href="https://doi.org/10.1016/s0378-4290(97)00060-9">https://doi.org/10.1016/s0378-4290(97)00060-9</a>
</div>
<div id="ref-johnen2012" class="csl-entry" role="listitem">
Johnen, T., Boettcher, U., Kage, H., 2012a. A variable thermal time of the double ridge to flag leaf emergence phase improves the predictive quality of a CERES-Wheat type phenology model. Computers and Electronics in Agriculture 89, 62–69. <a href="https://doi.org/10.1016/j.compag.2012.08.002">https://doi.org/10.1016/j.compag.2012.08.002</a>
</div>
<div id="ref-johnen2012a" class="csl-entry" role="listitem">
Johnen, T., Boettcher, U., Kage, H., 2012c. A variable thermal time of the double ridge to flag leaf emergence phase improves the predictive quality of a CERES-Wheat type phenology model. Computers and Electronics in Agriculture 89, 62–69. <a href="https://doi.org/10.1016/j.compag.2012.08.002">https://doi.org/10.1016/j.compag.2012.08.002</a>
</div>
<div id="ref-johnen2012b" class="csl-entry" role="listitem">
Johnen, T., Boettcher, U., Kage, H., 2012b. A variable thermal time of the double ridge to flag leaf emergence phase improves the predictive quality of a CERES-Wheat type phenology model. Computers and Electronics in Agriculture 89, 62–69. <a href="https://doi.org/10.1016/j.compag.2012.08.002">https://doi.org/10.1016/j.compag.2012.08.002</a>
</div>
<div id="ref-kage1999" class="csl-entry" role="listitem">
Kage, H., Stützel, H., 1999. HUME: An object oriented component library for generic modular modelling of dynamic systems. Symp. Eur. Soc. Agron. Spain.
</div>
<div id="ref-kirby1985" class="csl-entry" role="listitem">
KIRBY, E.J.M., APPLEYARD, M., FELLOWES, G., 1985. Leaf emergence and tillering in barley and wheat. Agronomie 5, 193–200. <a href="https://doi.org/10.1051/agro:19850301">https://doi.org/10.1051/agro:19850301</a>
</div>
<div id="ref-lancashire1991a" class="csl-entry" role="listitem">
LANCASHIRE, P.D., BLEIHOLDER, H., BOOM, T.V.D., LANGELÜDDEKE, P., STAUSS, R., WEBER, E., WITZENBERGER, A., 1991. A uniform decimal code for growth stages of crops and weeds. Annals of Applied Biology 119, 561–601. <a href="https://doi.org/10.1111/j.1744-7348.1991.tb04895.x">https://doi.org/10.1111/j.1744-7348.1991.tb04895.x</a>
</div>
<div id="ref-meinke1998" class="csl-entry" role="listitem">
Meinke, H., Hammer, G.L., Keulen, H. van, Rabbinge, R., 1998a. Improving wheat simulation capabilities in Australia from a cropping systems perspective III. The integrated wheat model (I<span>_</span>WHEAT). European Journal of Agronomy 8, 101–116. <a href="https://doi.org/10.1016/s1161-0301(97)00015-4">https://doi.org/10.1016/s1161-0301(97)00015-4</a>
</div>
<div id="ref-meinke1998a" class="csl-entry" role="listitem">
Meinke, H., Hammer, G.L., Keulen, H. van, Rabbinge, R., 1998b. Improving wheat simulation capabilities in Australia from a cropping systems perspective III. The integrated wheat model (I<span>_</span>WHEAT). European Journal of Agronomy 8, 101–116. <a href="https://doi.org/10.1016/s1161-0301(97)00015-4">https://doi.org/10.1016/s1161-0301(97)00015-4</a>
</div>
<div id="ref-meinke1997" class="csl-entry" role="listitem">
Meinke, H., L. Hammer, G., Keulen, H. van, Rabbinge, R., Keating, B.A., 1997. Improving wheat simulation capabilities in Australia from a cropping systems perspective: water and nitrogen effects on spring wheat in a semi-arid environment. European Journal of Agronomy 7, 75–88. <a href="https://doi.org/10.1016/s1161-0301(97)00032-4">https://doi.org/10.1016/s1161-0301(97)00032-4</a>
</div>
<div id="ref-neukam2016" class="csl-entry" role="listitem">
Neukam, D., Ahrends, H., Luig, A., Manderscheid, R., Kage, H., 2016. Integrating Wheat Canopy Temperatures in Crop System Models. Agronomy 6, 7. <a href="https://doi.org/10.3390/agronomy6010007">https://doi.org/10.3390/agronomy6010007</a>
</div>
<div id="ref-neukam2015" class="csl-entry" role="listitem">
Neukam, D., Böttcher, U., Kage, H., 2015. Modelling Wheat Stomatal Resistance in Hourly Time Steps from Micrometeorological Variables and Soil Water Status. Journal of Agronomy and Crop Science 202, 174–191. <a href="https://doi.org/10.1111/jac.12133">https://doi.org/10.1111/jac.12133</a>
</div>
<div id="ref-ratjen2012" class="csl-entry" role="listitem">
Ratjen, A.M., Böttcher, U., Kage, H., 2012. Improved modeling of grain number in winter wheat. Field Crops Research 133, 167–175. <a href="https://doi.org/10.1016/j.fcr.2012.04.002">https://doi.org/10.1016/j.fcr.2012.04.002</a>
</div>
<div id="ref-ratjen2015" class="csl-entry" role="listitem">
RATJEN, A.M., KAGE, H., 2015a. Nitrogen-limited light use efficiency in wheat crop simulators: comparing three model approaches. The Journal of Agricultural Science 154, 1090–1101. <a href="https://doi.org/10.1017/s0021859615001082">https://doi.org/10.1017/s0021859615001082</a>
</div>
<div id="ref-ratjen2015b" class="csl-entry" role="listitem">
Ratjen, A.M., Kage, H., 2015. Forecasting yield via reference- and scenario calculations. Computers and Electronics in Agriculture 114, 212–220. <a href="https://doi.org/10.1016/j.compag.2015.03.020">https://doi.org/10.1016/j.compag.2015.03.020</a>
</div>
<div id="ref-ratjen2015a" class="csl-entry" role="listitem">
RATJEN, A.M., KAGE, H., 2015b. Nitrogen-limited light use efficiency in wheat crop simulators: comparing three model approaches. The Journal of Agricultural Science 154, 1090–1101. <a href="https://doi.org/10.1017/s0021859615001082">https://doi.org/10.1017/s0021859615001082</a>
</div>
<div id="ref-ratjen2016" class="csl-entry" role="listitem">
Ratjen, A.M., Neukam, D., Kage, H., 2016. A Simple Drought<span>-</span>Sensitive Model for Leaf&nbsp;:&nbsp;Stem Partitioning of Wheat. Journal of Agronomy and Crop Science 202, 300–308. <a href="https://doi.org/10.1111/jac.12165">https://doi.org/10.1111/jac.12165</a>
</div>
<div id="ref-ritchie2015" class="csl-entry" role="listitem">
RITCHIE, J.T., 2015. Wheat phasic development. American Society of Agronomy, Crop Science Society of America, Soil Science Society of America, pp. 31–54. <a href="https://doi.org/10.2134/agronmonogr31.c3">https://doi.org/10.2134/agronmonogr31.c3</a>
</div>
<div id="ref-sinclair1992" class="csl-entry" role="listitem">
Sinclair, T.R., Amir, J., 1992. A model to assess nitrogen limitations on the growth and yield of spring wheat. Field Crops Research 30, 63–78. <a href="https://doi.org/10.1016/0378-4290(92)90057-g">https://doi.org/10.1016/0378-4290(92)90057-g</a>
</div>
<div id="ref-sinclair1989" class="csl-entry" role="listitem">
Sinclair, T.R., Horie, T., 1989. Leaf Nitrogen, Photosynthesis, and Crop Radiation Use Efficiency: A Review. Crop Science 29, 90–98. <a href="https://doi.org/10.2135/cropsci1989.0011183x002900010023x">https://doi.org/10.2135/cropsci1989.0011183x002900010023x</a>
</div>
<div id="ref-wang2002" class="csl-entry" role="listitem">
Wang, E., Engel, T., 2002. Simulation of growth, water and nitrogen uptake of a wheat crop using the SPASS model. Environmental Modelling &amp; Software 17, 387–402. <a href="https://doi.org/10.1016/s1364-8152(02)00006-3">https://doi.org/10.1016/s1364-8152(02)00006-3</a>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>